<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= board.title %></title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <%- include('partials/nav') %>
  <main class="app">
    <header class="header">
      <div>
        <h1><%= board.title %></h1>
        <p class="subtitle"><%= board.subtitle %></p>
      </div>
      <div class="header-right">
        <section class="connection">
          <span class="connection-text">Access via:</span>
          <span class="connection-url"><%= boardUrl %></span>
        </section>
      </div>
    </header>

    <section class="columns">
      <section class="column-group">
        <section class="column">
          <h2>Groceries</h2>
          <ul>
            <% board.groceries.forEach(function(item) { %>
              <li><span class="bullet">‚Ä¢</span> <%= item %></li>
            <% }) %>
          </ul>
        </section>

        <section class="column">
          <h2>Other Shopping</h2>
          <ul>
            <% board.shopping.forEach(function(item) { %>
              <li><span class="bullet">‚Ä¢</span> <%= item %></li>
            <% }) %>
          </ul>
        </section>
      </section>

      <section class="column-group">
        <section class="column">
          <h2>Reminders</h2>
          <ul>
            <% board.reminders.forEach(function(item) { %>
              <li><span class="bullet">‚Ä¢</span> <%= item %></li>
            <% }) %>
          </ul>
        </section>

        <section class="column">
          <h2>Chores</h2>
          <ul>
            <% board.chores.forEach(function(item) { %>
              <li><span class="bullet">‚Ä¢</span> <%= item %></li>
            <% }) %>
          </ul>
        </section>
      </section>
    </section>

    <section class="messages">
      <h2>Messages</h2>
      <ul class="message-list">
        <% messages.forEach(function(msg) { %>
          <li class="message-item">
            <div class="message-user" style="--user-color: <%= msg.userColor %>">
              <span class="dot"></span>
              <span class="name"><%= msg.userName %></span>
              <span class="time"><%= msg.at %></span>
            </div>
            <div class="message-text"><%= msg.text %></div>
          </li>
        <% }) %>
      </ul>
      <p class="read-only">This board is currently read‚Äëonly. Editing and logins will be added later.</p>
    </section>
  </main>
  <script>
    (function () {
      const STORAGE_KEY = 'homeboard-theme';
      const USER_KEY = 'homeboard-user-name';
      const root = document.documentElement;

      function applyTheme(theme) {
        root.dataset.theme = theme;
        const label = document.querySelector('.theme-toggle__label');
        const icon = document.querySelector('.theme-toggle__icon');
        if (!label || !icon) return;
        if (theme === 'light') {
          label.textContent = 'Light';
          icon.textContent = '‚òÄÔ∏è';
        } else {
          label.textContent = 'Dark';
          icon.textContent = 'üåô';
        }
      }

      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored === 'light' || stored === 'dark') {
        applyTheme(stored);
      } else if (
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: light)').matches
      ) {
        applyTheme('light');
      } else {
        applyTheme('dark');
      }

      const btn = document.querySelector('.theme-toggle');
      if (btn) {
        btn.addEventListener('click', function () {
          const next = root.dataset.theme === 'light' ? 'dark' : 'light';
          applyTheme(next);
          localStorage.setItem(STORAGE_KEY, next);
        });
      }

      function applyUser() {
        const name = localStorage.getItem(USER_KEY);
        const loginLink = document.getElementById('nav-login-link');
        const logoutBtn = document.getElementById('nav-logout-button');

        if (loginLink) {
          loginLink.textContent = name && name.trim() ? name : 'Login';
        }

        if (logoutBtn) {
          logoutBtn.style.display = name && name.trim() ? 'inline-flex' : 'none';
        }
      }

      applyUser();

      const logoutBtn = document.getElementById('nav-logout-button');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function () {
          localStorage.removeItem(USER_KEY);
          applyUser();
        });
      }

      // Auto-refresh the board every 60 seconds to pick up changes.
      const ONE_MINUTE_MS = 60_000;
      setInterval(function () {
        window.location.reload();
      }, ONE_MINUTE_MS);
    })();
  </script>
</body>
</html>
